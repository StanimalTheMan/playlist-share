(this["webpackJsonpplaylist-share"]=this["webpackJsonpplaylist-share"]||[]).push([[0],{159:function(e,t,n){"use strict";n.r(t);var a,i,r,c=n(0),o=n.n(c),s=n(16),l=n.n(s),u=n(22),d=n(43),j=n.n(d),b=n(59),p=n(68),O=n(19),g=n(197),h=n(239),m=n(203),x=n(204),f=n(232),v=n(205),y=n(206),S=n(207),w=n(208),N=n(209),C=n(69),k=n.n(C),I=n(85),q=n.n(I),P=n(84),_=n.n(P),E=n(242),F=n(33),Q=n(234),T=Object(Q.a)(a||(a=Object(F.a)(["\n  mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]))),$=Object(Q.a)(i||(i=Object(F.a)(["\n  mutation addSong(\n    $title: String!\n    $artist: String!\n    $thumbnail: String!\n    $duration: Float!\n    $url: String!\n  ) {\n    insert_songs(\n      objects: {\n        title: $title\n        artist: $artist\n        thumbnail: $thumbnail\n        duration: $duration\n        url: $url\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]))),A=Object(Q.a)(r||(r=Object(F.a)(["\n  mutation deleteSong($id: uuid!) {\n    delete_songs(where: { id: { _eq: $id } }) {\n      returning {\n        id\n        thumbnail\n        artist\n        title\n      }\n    }\n  }\n"]))),G=n(4),R=Object(g.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),D={duration:0,title:"",artist:"",thumbnail:""};var B=function(){var e=R(),t=Object(E.a)($),n=Object(u.a)(t,2),a=n[0],i=n[1].error,r=o.a.useState(""),c=Object(u.a)(r,2),s=c[0],l=c[1],d=o.a.useState(!1),g=Object(u.a)(d,2),C=g[0],I=g[1],P=o.a.useState(!1),F=Object(u.a)(P,2),Q=F[0],T=F[1],A=o.a.useState(D),B=Object(u.a)(A,2),U=B[0],L=B[1];function J(e){var t=e.target,n=t.name,a=t.value;L((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(p.a)({},n,a))}))}function W(){T(!1)}function z(){return(z=Object(b.a)(j.a.mark((function e(t){var n,a,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}i=Y(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,H(a);case 9:i=e.sent;case 10:L(Object(O.a)(Object(O.a)({},i),{},{url:s}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return(M=Object(b.a)(j.a.mark((function e(){var t,n,i,r,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=U.url,n=U.thumbnail,i=U.duration,r=U.title,c=U.artist,e.next=4,a({variables:{url:t.length>0?t:null,thumbnail:n.length>0?n:null,duration:i>0?i:null,title:r.length>0?r:null,artist:c.length>0?c:null}});case 4:W(),L(D),l(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error adding song",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Y(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,i=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(i,"/0.jpg")}}function H(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))}function V(e){var t,n;return null===i||void 0===i||null===(t=i.graphQLErrors[0])||void 0===t||null===(n=t.extensions)||void 0===n?void 0:n.path.includes(e)}o.a.useEffect((function(){var e=q.a.canPlay(s)||_.a.canPlay(s);I(e)}),[s]);var K=U.thumbnail,X=U.title,Z=U.artist;return Object(G.jsxs)("div",{className:e.container,children:[Object(G.jsxs)(h.a,{className:e.dialog,open:Q,onClose:W,children:[Object(G.jsx)(m.a,{children:"Edit Song"}),Object(G.jsxs)(x.a,{children:[Object(G.jsx)("img",{src:K,alt:"Song thumbnail",className:e.thumbnail}),Object(G.jsx)(f.a,{value:X,onChange:J,margin:"dense",name:"title",label:"Title",fullWidth:!0,error:V("title"),helperText:V("title")&&"Fill out field"}),Object(G.jsx)(f.a,{value:Z,onChange:J,margin:"dense",name:"artist",label:"Artist",fullWidth:!0,error:V("artist"),helperText:V("artist")&&"Fill out field"}),Object(G.jsx)(f.a,{value:K,onChange:J,margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,error:V("thumbnail"),helperText:V("thumbnail")&&"Fill out field"})]}),Object(G.jsxs)(v.a,{children:[Object(G.jsx)(y.a,{onClick:W,color:"secondary",children:"Cancel"}),Object(G.jsx)(y.a,{onClick:function(){return M.apply(this,arguments)},variant:"outlined",color:"primary",children:"Add Song"})]})]}),Object(G.jsx)(f.a,{className:e.urlInput,onChange:function(e){return l(e.target.value)},value:s,placeholder:"Add Youtube or Soundcloud Url",fullWidth:!0,margin:"normal",type:"url",InputProps:{startAdornment:Object(G.jsx)(S.a,{position:"start",children:Object(G.jsx)(w.a,{})})}}),Object(G.jsx)(y.a,{disabled:!C,className:e.addSongButton,onClick:function(){return T(!0)},variant:"contained",color:"primary",endIcon:Object(G.jsx)(N.a,{}),children:"Add"}),Object(G.jsx)(k.a,{url:s,hidden:!0,onReady:function(e){return z.apply(this,arguments)}})]})},U=n(210),L=n(211),J=n(113),W=n(212),z=Object(g.a)((function(e){return{title:{marginLeft:e.spacing(2)}}}));var M,Y=function(){var e=z();return Object(G.jsx)(U.a,{color:"primary",position:"fixed",children:Object(G.jsxs)(L.a,{children:[Object(G.jsx)(W.a,{}),Object(G.jsx)(J.a,{className:e.title,variant:"h6",component:"h1",children:"Playlist Share"})]})})},H=n(213),V=n(214),K=n(215),X=n(216),Z=n(217),ee=n(218),te=n(219),ne=n(220),ae=n(221),ie=n(222),re=n(244),ce=Object(Q.a)(M||(M=Object(F.a)(["\n  subscription getSongs {\n    songs(order_by: { created_at: desc }) {\n      artist\n      duration\n      id\n      thumbnail\n      title\n      url\n    }\n  }\n"])));var oe=Object(g.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{objectFit:"cover",width:140,height:140}}}));function se(e){var t=e.song,n=t.id,a=oe(),i=Object(E.a)(T,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),r=Object(u.a)(i,1)[0],c=Object(E.a)(A),s=Object(u.a)(c,1)[0],l=o.a.useContext(Ce),d=l.state,p=l.dispatch,g=o.a.useState(!1),h=Object(u.a)(g,2),m=h[0],x=h[1],f=t.title,v=t.artist,y=t.thumbnail;function S(){return(S=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s({variables:{id:t.id}});case 3:return e.next=5,r({variables:{input:Object(O.a)(Object(O.a)({},t),{},{__typename:"Song"})}});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("Error deleting song",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}return o.a.useEffect((function(){var e=d.isPlaying&&n===d.song.id;x(e)}),[n,d.song.id,d.isPlaying]),Object(G.jsx)(V.a,{className:a.container,children:Object(G.jsxs)("div",{className:a.songInfoContainer,children:[Object(G.jsx)(K.a,{image:y,className:a.thumbnail}),Object(G.jsxs)("div",{className:a.songInfo,children:[Object(G.jsxs)(X.a,{children:[Object(G.jsx)(J.a,{gutterBottom:!0,variant:"h5",component:"h2",children:f}),Object(G.jsx)(J.a,{variant:"body1",component:"p",color:"textSecondary",children:v})]}),Object(G.jsxs)(Z.a,{children:[Object(G.jsx)(ee.a,{onClick:function(){p({type:"SET_SONG",payload:{song:t}}),p(d.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary",children:m?Object(G.jsx)(te.a,{}):Object(G.jsx)(ne.a,{})}),Object(G.jsx)(ee.a,{onClick:function(){r({variables:{input:Object(O.a)(Object(O.a)({},t),{},{__typename:"Song"})}})},size:"small",color:"secondary",children:Object(G.jsx)(ae.a,{})}),Object(G.jsx)(ee.a,{onClick:function(){return S.apply(this,arguments)},children:Object(G.jsx)(ie.a,{color:"error"})})]})]})]})})}var le=function(){var e=Object(re.a)(ce),t=e.data,n=e.loading,a=e.error;return n?Object(G.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50},children:Object(G.jsx)(H.a,{})}):a?Object(G.jsx)("div",{children:"Error fetching songs"}):Object(G.jsx)("div",{children:t.songs.map((function(e){return Object(G.jsx)(se,{song:e},e.id)}))})},ue=n(223),de=n(240);var je=Object(g.a)({avatar:{width:44,height:44},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}});function be(e){var t=e.song,n=je(),a=Object(E.a)(T,{onCompleted:function(e){console.log(e),localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(u.a)(a,1)[0],r=t.thumbnail,c=t.artist,o=t.title;return Object(G.jsxs)("div",{className:n.container,children:[Object(G.jsx)(de.a,{src:r,alt:"Song thumbnail",className:n.avatar}),Object(G.jsxs)("div",{className:n.songInfoContainer,children:[Object(G.jsx)(J.a,{variant:"subtitle2",className:n.text,children:o}),Object(G.jsx)(J.a,{color:"textSecondary",variant:"body2",className:n.text,children:c})]}),Object(G.jsx)(ee.a,{onClick:function(){i({variables:{input:Object(O.a)(Object(O.a)({},t),{},{__typename:"Song"})}})},children:Object(G.jsx)(ie.a,{color:"error"})})]})}var pe,Oe=function(e){var t=e.queue;return Object(ue.a)((function(e){return e.breakpoints.up("md")}))&&Object(G.jsxs)("div",{style:{margin:"10px 0"},children:[Object(G.jsxs)(J.a,{color:"textSecondary",variant:"button",children:["QUEUE (",t.length,")"]}),t.map((function(e,t){return Object(G.jsx)(be,{song:e},t)}))]})},ge=n(241),he=n(224),me=n(225),xe=n(238),fe=Object(Q.a)(pe||(pe=Object(F.a)(["\n  query getQueuedSongs {\n    queue @client {\n      id\n      duration\n      title\n      artist\n      thumbnail\n      url\n    }\n  }\n"]))),ve=Object(g.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}}));var ye=function(){var e,t=Object(xe.a)(fe).data,n=o.a.useRef(),a=o.a.useContext(Ce),i=a.state,r=a.dispatch,c=o.a.useState(0),s=Object(u.a)(c,2),l=s[0],d=s[1],j=o.a.useState(0),b=Object(u.a)(j,2),p=b[0],O=b[1],g=o.a.useState(!1),h=Object(u.a)(g,2),m=h[0],x=h[1],f=o.a.useState(0),v=Object(u.a)(f,2),y=v[0],S=v[1],w=ve();return o.a.useEffect((function(){var e=t.queue.findIndex((function(e){return e.id===i.song.id}));S(e)}),[t.queue,i.song.id]),o.a.useEffect((function(){var e=t.queue[y+1];l>=.99&&e&&(d(0),r({type:"SET_SONG",payload:{song:e}}))}),[t.queue,l,r,y]),Object(G.jsxs)(G.Fragment,{children:[Object(G.jsxs)(V.a,{variant:"outlined",className:w.container,children:[Object(G.jsxs)("div",{className:w.details,children:[Object(G.jsxs)(X.a,{className:w.content,children:[Object(G.jsx)(J.a,{variant:"h5",component:"h3",children:i.song.title}),Object(G.jsx)(J.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:i.song.artist})]}),Object(G.jsxs)("div",{className:w.controls,children:[Object(G.jsx)(ee.a,{onClick:function(){var e=t.queue[y-1];e&&r({type:"SET_SONG",payload:{song:e}})},children:Object(G.jsx)(he.a,{})}),Object(G.jsx)(ee.a,{onClick:function(){r(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:i.isPlaying?Object(G.jsx)(te.a,{className:w.playIcon}):Object(G.jsx)(ne.a,{className:w.playIcon})}),Object(G.jsx)(ee.a,{onClick:function(){var e=t.queue[y+1];e&&r({type:"SET_SONG",payload:{song:e}})},children:Object(G.jsx)(me.a,{})}),Object(G.jsx)(J.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:(e=p,new Date(1e3*e).toISOString().substr(11,8))})]}),Object(G.jsx)(ge.a,{onMouseDown:function(){x(!0)},onMouseUp:function(){x(!1),n.current.seekTo(l)},onChange:function(e,t){d(t)},value:l,type:"range",min:0,max:1,step:.01})]}),Object(G.jsx)(k.a,{ref:n,onProgress:function(e){var t=e.played,n=e.playedSeconds;m||(d(t),O(n))},url:i.song.url,playing:i.isPlaying,hidden:!0}),Object(G.jsx)(K.a,{className:w.thumbnail,image:i.song.thumbnail})]}),Object(G.jsx)(Oe,{queue:t.queue})]})},Se=n(237),we=n(226);var Ne=function(e,t){switch(t.type){case"PLAY_SONG":return Object(O.a)(Object(O.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(O.a)(Object(O.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(O.a)(Object(O.a)({},e),{},{song:t.payload.song});default:return e}},Ce=o.a.createContext({song:{id:"641b3969-f86d-4013-b9c3-6bb8512cc4c4",title:"Battle Belongs",artist:"Phil Wickham",thumbnail:"http://img.youtube.com/vi/qtvQNzPHn-w/0.jpg",url:"https://www.youtube.com/watch?v=qtvQNzPHn-w",duration:286},isPlaying:!1});var ke,Ie=function(){var e=o.a.useContext(Ce),t=o.a.useReducer(Ne,e),n=Object(u.a)(t,2),a=n[0],i=n[1],r=Object(ue.a)((function(e){return e.breakpoints.up("sm")})),c=Object(ue.a)((function(e){return e.breakpoints.up("md")}));return Object(G.jsxs)(Ce.Provider,{value:{state:a,dispatch:i},children:[Object(G.jsx)(Se.a,{only:"xs",children:Object(G.jsx)(Y,{})}),Object(G.jsxs)(we.a,{container:!0,spacing:3,children:[Object(G.jsxs)(we.a,{style:{paddingTop:r?80:10},item:!0,xs:12,md:7,children:[Object(G.jsx)(B,{}),Object(G.jsx)(le,{})]}),Object(G.jsx)(we.a,{style:c?{position:"fixed",width:"100%",right:0,top:70}:{position:"fixed",width:"100%",left:0,bottom:0},item:!0,xs:12,md:5,children:Object(G.jsx)(ye,{})})]})]})},qe=n(230),Pe=n(231),_e=n(229),Ee=n(109),Fe=n(227),Qe=n(228),Te=Object(Ee.a)({palette:{type:"dark",primary:Fe.a,secondary:Qe.a}}),$e=n(110),Ae=n(233),Ge=n(235),Re=n(107),De=new Ae.a({link:new Re.a({uri:"wss://playlist-share-app.herokuapp.com/v1/graphql",options:{reconnect:!0}}),cache:new Ge.a,typeDefs:Object(Q.a)(ke||(ke=Object(F.a)(["\n    type Song {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n\n    input SongInput {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n\n    type Query {\n      queue: [Song]!\n    }\n\n    type Mutation {\n      addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n  "]))),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,i=n.cache,r=i.readQuery({query:fe});if(r){var c=r.queue,o=c.some((function(e){return e.id===a.id}))?c.filter((function(e){return e.id!==a.id})):[].concat(Object($e.a)(c),[a]);return i.writeQuery({query:fe,data:{queue:o}}),o}return[]}}}}),Be={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};De.writeQuery({query:fe,data:Be});var Ue=De;l.a.render(Object(G.jsx)(_e.a,{client:Ue,children:Object(G.jsxs)(qe.a,{theme:Te,children:[Object(G.jsx)(Pe.a,{}),Object(G.jsx)(Ie,{})]})}),document.getElementById("root"))}},[[159,1,2]]]);
//# sourceMappingURL=main.a2c51cc2.chunk.js.map